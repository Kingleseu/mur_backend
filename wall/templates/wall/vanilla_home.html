{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mur de Témoignages Bunda21 - CMP</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@400;700&family=Indie+Flower&family=Caveat:wght@400;700&family=Kalam:wght@400;700&family=Permanent+Marker&family=Shadows+Into+Light&family=Patrick+Hand&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="{% static 'styles-final.css' %}">
  <link rel="stylesheet" href="{% static 'css/form.css' %}">
  <link rel="stylesheet" href="{% static 'css/carousel-video.css' %}">
  <link rel="stylesheet" href="{% static 'css/footer-cta-v3.css' %}">
  <link rel="stylesheet" href="{% static 'css/modal-color-strip.css' %}">
  <link rel="stylesheet" href="{% static 'css/dialog-fix.css' %}">

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head> 
<body>

  <!-- ============================================
       HERO SECTION
       ============================================  -->
  <section id="hero" class="hero-section">
    <div class="hero-bg-black"></div>
    <div class="hero-bg-glow"></div>
    
    <!-- Auth Button -->
    <div class="auth-button-container" id="authContainer"></div>

    <!-- Main Content -->
    <div class="hero-content">
      <div class="hero-grid">
        
        <!-- LEFT: Text Content -->
        <div class="hero-text">
          <div class="hero-logo">
            <img src="{% static 'img/logo.svg' %}" alt="Bunda21 Logo" class="logo-img" style="width: clamp(260px, 40vw, 400px); height: auto;">
          </div>
          
          <h2 class="hero-title">Ce que Dieu a fait pour nous !</h2>
          <h3 class="hero-subtitle">Partagé, conservé, célébré.</h3>
          
          <p class="hero-description">
            Un espace vivant où chaque fidèle partage son action de grâce et proclame, comme il est écrit :
            <strong>« Ils l'ont vaincu à cause de la parole de leur témoignage » (Apocalypse 12:11).</strong>
          </p>
          
          <button class="cta-button" id="heroCTA">
            J'ai un témoignage
          </button>
          
          <div class="hero-counter">
            <span class="counter-number" id="testimoniesCount">0</span>
            <span class="counter-label">témoignages enregistrés</span>
          </div>
        </div>

        <!-- RIGHT: Carousel Columns -->
        <div class="hero-carousel-wrapper">
          <div class="carousel-columns">
            <div class="carousel-column" id="carouselCol1"></div>
            <div class="carousel-column" id="carouselCol2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scroll Indicator -->
    <div class="scroll-indicator">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    </div>
  </section>

  <!-- ============================================
       TESTIMONY WALL SECTION
       ============================================ -->
  <section id="wall" class="wall-section">
    <div class="wall-container">
      
      <!-- Header -->
      <div class="wall-header">
        <div class="wall-header-content">
          <div class="wall-title-group">
            <h2 class="wall-title">Mur en direct</h2>
            <p class="wall-subtitle">Aperçu temps réel des actions de grâce publiées.</p>
          </div>
          <button class="add-testimony-btn" id="addTestimonyBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Partager mon témoignage
          </button>
        </div>

        <!-- Category Filters -->
        <div class="category-filters" id="categoryFilters"></div>
      </div>

      <!-- Testimonies Grid -->
      <div class="testimonies-grid" id="testimoniesGrid"></div>
      <!-- /Testimonies Grid -->

      <!-- Pagination -->
      <div class="pagination" id="pagination"></div>
    </div>
  </section>



  <!-- ============================================ 
       FOOTER CTA SECTION
       ============================================ -->
  <section class="footer-cta-section">
    <div class="footer-cta-glow"></div>
    
    <div class="footer-cta-content">
      <!-- Dynamic Stats Badges -->
      <div class="footer-stats-badges">
        <div class="footer-stat-badge">
          <span class="stat-icon">📝</span>
          <span class="stat-value" id="footerTestimoniesCount">0</span>
          <span class="stat-label">témoignages partagés</span>
        </div>
        <div class="footer-stat-badge">
          <span class="stat-icon">🙌</span>
          <span class="stat-value" id="footerAmensCount">0</span>
          <span class="stat-label">Amens reçus</span>
        </div>
        <div class="footer-stat-badge">
          <span class="stat-icon">🧡</span>
          <span class="stat-value" id="footerSharesCount">0</span>
          <span class="stat-label">partages</span>
        </div>
      </div>

      <h2 class="footer-title">Prêt à témoigner ?</h2>
      
      <p class="footer-description">
        Votre histoire peut encourager, inspirer et fortifier la foi de milliers de personnes.<br>
        Partagez ce que Dieu a fait dans votre vie.
      </p>

      <!-- Steps Cards -->
      <div class="footer-steps">
        <div class="step-card">
          <div class="step-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 20h9"></path>
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
          </div>
          <h3 class="step-title">Écris ton témoignage</h3>
          <p class="step-description">Titre court (max 50 caractères) + description. Option photo (modérée).</p>
        </div>

        <div class="step-card">
          <div class="step-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="1"></circle>
              <path d="M12 2v4"></path>
              <path d="M12 18v4"></path>
              <path d="m4.93 4.93 2.83 2.83"></path>
              <path d="m16.24 16.24 2.83 2.83"></path>
              <path d="M2 12h4"></path>
              <path d="M18 12h4"></path>
              <path d="m4.93 19.07 2.83-2.83"></path>
              <path d="m16.24 7.76 2.83-2.83"></path>
            </svg>
          </div>
          <h3 class="step-title">Épingle et célèbre</h3>
          <p class="step-description">Ton post-it apparaît sur le mur avec ta couleur. Animation douce à l'ajout.</p>
        </div>

        <div class="step-card">
          <div class="step-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
          </div>
          <h3 class="step-title">Partage & modère</h3>
          <p class="step-description">Liens de partage, signalement, et validation par les modérateurs CMP.</p>
        </div>
      </div>

      <button class="footer-cta-button" id="footerCTA">
          Écrire mon témoignage
      </button>

      <div class="footer-info">
        <p>© 2025 Centre Missionnaire Philadelphie - Bunda21</p>
        <p>Tous les témoignages sont vérifiés avant publication</p>
      </div>
    </div>
  </section>

  <!-- ============================================
       MODALS (Auth, Testimony, Video, Form)
       ============================================ -->
  <!-- Auth Modal -->
  <!-- Auth Dialog -->
  <dialog id="otpAuthDialog" class="modal auth-modal">
    <div class="modal-color-strip"></div>
    <div class="modal-content auth-modal-card">
      <div class="modal-header">
        <div>
          <h2 class="modal-title" id="authModalTitle">Espace membre</h2>
          <p class="modal-subtitle" id="authModalSubtitle">Identifie-toi pour partager ou célébrer un témoignage.</p>
        </div>
        <button class="modal-close" type="button" id="otpCloseBtn">&times;</button>
      </div>

      <div class="tabs-container auth-tabs">
        <button type="button" class="tab-btn active" data-auth-mode="signup">
          Créer un compte
        </button>
        <button type="button" class="tab-btn" data-auth-mode="login">
          Connexion
        </button>
      </div>

      <div class="auth-steps">
        <div id="authStepForm">
          <div class="form-row" id="authNameRow">
            <div class="form-group">
              <label>Prénom</label>
              <input type="text" id="authFirstName" class="form-input" placeholder="Prénom">
            </div>
            <div class="form-group">
              <label>Nom</label>
              <input type="text" id="authLastName" class="form-input" placeholder="Nom">
            </div>
          </div>

          <div class="form-group">
            <label>Email</label>
            <input type="email" id="authEmail" class="form-input" placeholder="email@example.com" required>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" id="otpCancelBtn">Annuler</button>
            <button type="button" class="submit-btn" id="otpStartBtn">Recevoir le code</button>
          </div>
        </div>

        <div id="authStepCode" class="hidden">
          <p class="modal-subtitle" id="otpSummary">
            Un code de 6 chiffres vient d'être envoyé à votre adresse email.
          </p>
          <div class="form-group">
            <label>Code</label>
            <input type="text" id="authCode" maxlength="6" class="form-input code-input" placeholder="000000">
          </div>

          <div class="otp-countdown">
            <span id="otpCountdown">Renvoyer un code dans 01:00</span>
            <button type="button" class="link-btn" id="otpResendBtn" disabled>Renvoyer le code</button>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" id="otpBackBtn">Modifier l'email</button>
            <button type="button" class="submit-btn" id="otpVerifyBtn">Valider le code</button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Testimony Modal (Text) -->
  <!-- Testimony Dialog (Texte) -->
  <dialog id="testimonyDialog" class="modal testimony-modal">
   
     <div class="modal-color-strip"></div>

    <div class="modal-content">
      <div class="modal-header">
        <button class="modal-nav-btn modal-prev" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <h2 class="modal-title testimony-modal-title"></h2>
        <button class="modal-nav-btn modal-next" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
        <button class="modal-close" type="button">&times;</button>
      </div>
      <div class="testimony-modal-body">
        <div class="testimony-meta">
          <div class="testimony-avatar"></div>
          <div class="testimony-author-info">
            <div class="testimony-author"></div>
            <div class="testimony-location"></div>
          </div>
          <div class="testimony-date"></div>
        </div>
        <div class="testimony-content"></div>
        <div class="testimony-gallery hidden" id="testimonyGallery"></div>
        <div class="testimony-actions">
          <button class="amen-button" type="button">
            <span>🙌</span>
            Amen (<span class="amen-count">0</span>)
          </button>
          <div class="share-buttons">
            <button class="share-btn" data-platform="x" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4l16 16"></path>
                <path d="M20 4L4 20"></path>
              </svg>
            </button>
            <button class="share-btn" data-platform="whatsapp" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
              </svg>
            </button>
            <button class="share-btn" data-platform="copy" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Video Modal -->
  <!-- Video Dialog -->
  <dialog id="videoDialog" class="modal video-modal">
    <div class="modal-color-strip"></div> 
    <div class="modal-content">
      <div class="modal-header">
        <button class="modal-nav-btn modal-prev" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <h2 class="modal-title video-modal-title"></h2>
        <button class="modal-nav-btn modal-next" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
        <button class="modal-close" type="button">&times;</button>
      </div>
      <div class="video-modal-body">
        <video id="videoPlayer" controls></video>
        <div class="video-meta">
          <div class="video-author"></div>
          <div class="video-location"></div>
          <div class="video-date"></div>
        </div>
        <div class="testimony-actions">
          <button class="amen-button" type="button">
            <span>🙌</span>
            Amen (<span class="amen-count">0</span>)
          </button>
          <div class="share-buttons">
            <button class="share-btn" data-platform="x" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4l16 16"></path>
                <path d="M20 4L4 20"></path>
              </svg>
            </button>
            <button class="share-btn" data-platform="whatsapp" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
              </svg>
            </button>
            <button class="share-btn" data-platform="copy" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Testimony Form Modal -->
  <dialog id="testimonyFormDialog" class="modal">
  <div class="modal-color-strip"></div>

  <div class="modal-content testimony-form-modal-large">
    <div class="modal-header">
      <div>
        <h2 class="modal-title">Partagez votre témoignage</h2>
        <p class="modal-subtitle">Racontez-nous comment Dieu a agi dans votre vie. Votre histoire sera vérifiée avant d'être publiée.</p>
      </div>
      <button class="modal-close" type="button">&times;</button>
    </div>

      <form id="testimonyForm" class="testimony-form-complete" novalidate>
      <!-- Type de témoignage -->
      <div class="form-group">
        <label>Type de témoignage</label>
        <div class="tabs-container" id="typeTabs" role="tablist" aria-label="Type de témoignage">
          <!-- pastille glissante -->
          <span class="tab-indicator" aria-hidden="true"></span>
          <button type="button" class="tab-btn active" data-type="text"
                  role="tab" aria-selected="true" aria-controls="textTestimonySection">
            <i data-lucide="file-text" style="width:16px;height:16px;vertical-align:-2px"></i>&nbsp;Texte & Photos
          </button>
          <button type="button" class="tab-btn" data-type="video"
                  role="tab" aria-selected="false" aria-controls="videoTestimonySection">
            <i data-lucide="video" style="width:16px;height:16px;vertical-align:-2px"></i>&nbsp;Vidéo
          </button>
        </div>
      </div>

      <!-- Titre -->
      <div class="form-group">
        <label for="formTitle">Titre du témoignage *</label>
        <input type="text" id="formTitle" class="form-input" placeholder="Ex: Guérison miraculeuse" required>
      </div>

      <!-- Catégorie -->
      <div class="form-group">
        <label for="formCategory">Catégorie *</label>
        <select id="formCategory" class="form-input" required></select>
      </div>
      <div class="form-group hidden" id="customCategoryGroup">
        <label for="formCategoryCustom">Précisez la catégorie</label>
        <input type="text" id="formCategoryCustom" class="form-input" placeholder="Ex: Mariage, Études..." autocomplete="off">
        <p class="form-hint">Lorsque vous choisissez « Autre », indiquez ici le nom de votre catégorie.</p>
      </div>

      <!-- Section TEXTE -->
      <div id="textTestimonySection" class="testimony-section" role="tabpanel" aria-labelledby="text-tab">
        <div class="form-group">
          <label>Votre témoignage *</label>
          <div id="postItPreview" class="postit-preview">
            <div class="postit-controls">
              <!-- Font selector -->
              <div style="position: relative;">
                <button type="button" id="fontSelector" class="control-btn" aria-label="Choisir la police">
                  <span id="fontSelectorLabel" class="icon-aa">Aa</span>
                </button>
                <div id="fontPopover" class="popover hidden">
                  <h4>Style de police</h4>
                  <div class="font-grid">
                    <button type="button" class="font-option active" data-font="Sans-serif" style="font-family: Inter, sans-serif;">Aa</button>
                    <button type="button" class="font-option" data-font="Serif" style="font-family: Merriweather, serif;">Aa</button>
                    <button type="button" class="font-option" data-font="Indie Flower" style="font-family: 'Indie Flower', cursive;">Aa</button>
                    <button type="button" class="font-option" data-font="Caveat" style="font-family: Caveat, cursive;">Aa</button>
                    <button type="button" class="font-option" data-font="Patrick Hand" style="font-family: 'Patrick Hand', cursive;">Aa</button>
                    <button type="button" class="font-option" data-font="Kalam" style="font-family: Kalam, cursive;">Aa</button>
                    <button type="button" class="font-option" data-font="Permanent Marker" style="font-family: 'Permanent Marker', cursive;">Aa</button>
                    <button type="button" class="font-option" data-font="Shadows Into Light" style="font-family: 'Shadows Into Light', cursive;">Aa</button>
                  </div>
                </div>
              </div>

              <!-- Color selector -->
              <div style="position: relative;">
                <button type="button" id="colorSelector" class="control-btn"><i data-lucide="palette" style="width:18px;height:18px"></i></button>
                <div id="colorPopover" class="popover hidden">
                  <h4>Couleur du post-it</h4>
                  <div class="color-grid">
                    <button type="button" class="color-option active" data-color="#FFF6D9" style="background: #FFF6D9; border-color: #F5D693;"></button>
                    <button type="button" class="color-option" data-color="#FFE5E5" style="background: #FFE5E5; border-color: #FFD6DC;"></button>
                    <button type="button" class="color-option" data-color="#E4FFEB" style="background: #E4FFEB; border-color: #B8E6C3;"></button>
                    <button type="button" class="color-option" data-color="#F3E5F5" style="background: #F3E5F5; border-color: #E1BEE7;"></button>
                    <button type="button" class="color-option" data-color="#FFE0B2" style="background: #FFE0B2; border-color: #FFCC80;"></button>
                    <button type="button" class="color-option" data-color="#E3F2FD" style="background: #E3F2FD; border-color: #BBDEFB;"></button>
                    <button type="button" class="color-option" data-color="#FFE0E0" style="background: #FFE0E0; border-color: #FFCDD2;"></button>
                    <button type="button" class="color-option" data-color="#E0F7FA" style="background: #E0F7FA; border-color: #B2EBF2;"></button>
                  </div>
                </div>
              </div>
            </div>

            <div class="testimony-textarea-wrapper">
              <textarea id="formTestimony" name="testimony_text" placeholder="Partagez en détail comment Dieu est intervenu dans votre vie..."></textarea>
            </div>
          </div>
          <p class="char-count"><span id="charCount">0/500</span> caractères (max 500)</p>
        </div>

        <!-- Upload photos -->
        <div class="form-group">
          <div class="upload-header">
            <label>Photos (optionnel, max 5)</label>
            <button type="button" id="uploadPhotosBtn" class="upload-btn"><i data-lucide="camera" style="width:16px;height:16px"></i>&nbsp;Ajouter des photos</button>
            <input type="file" id="photoInput" accept="image/*" multiple hidden>
          </div>
          <div id="photosPreview" class="photos-grid"></div>
        </div>
      </div>

      <!-- Section VIDÉO -->
      <div id="videoTestimonySection" class="testimony-section hidden" role="tabpanel" aria-labelledby="video-tab">
        <div class="form-group">
          <label>Vidéo de témoignage (max 2 minutes) *</label>

          <div id="videoUploadOptions" class="video-options">
            <button type="button" id="recordVideoBtn" class="video-option-btn">
              <div class="option-icon"><i data-lucide="camera" style="width:26px;height:26px"></i></div>
              <div class="option-text">
                <strong>Enregistrer maintenant</strong>
                <span>Utiliser ma caméra</span>
              </div>
            </button>

            <button type="button" id="uploadVideoBtn" class="video-option-btn">
              <div class="option-icon"><i data-lucide="upload" style="width:26px;height:26px"></i></div>
              <div class="option-text">
                <strong>Uploader une vidéo</strong>
                <span>Depuis mon appareil</span>
              </div>
            </button>
            <input type="file" id="videoInput" accept="video/*" hidden>
          </div>

          <!-- Recording -->
          <div id="recordingSection" class="recording-section hidden" data-max-seconds="120">
            <video id="recordingPreview" autoplay muted></video>

            <div class="recording-controls">
              <div class="recording-status">
                <div class="recording-indicator">
                  <span class="recording-dot"></span>
                  Enregistrement en cours...
                </div>

                <!-- TIMER visuel -->
                <div class="rec-timer-inline" aria-live="polite">
                  <svg class="rec-ring" viewBox="0 0 44 44">
                    <circle class="ring-bg" cx="22" cy="22" r="20"></circle>
                    <circle class="ring-fg" cx="22" cy="22" r="20"></circle>
                  </svg>
                  <div class="rec-time">
                    <span id="recMinutes">02</span>:<span id="recSeconds">00</span>
                  </div>
                </div>
              </div>

              <button type="button" id="stopRecordingBtn" class="stop-btn">
                Arrêter
              </button>
            </div>
          </div>

          <!-- Preview -->
          <div id="videoPreviewSection" class="video-preview-section hidden">
            <video id="videoPreviewPlayer" controls></video>
            <button type="button" id="replaceVideoBtn" class="replace-btn">
              Remplacer la vidéo
            </button>
          </div>
        </div>
      </div>

      <!-- Info note -->
      <div class="info-note">
        <i data-lucide="info" style="width:16px;height:16px;vertical-align:-2px"></i>&nbsp;<strong>Note:</strong> Votre témoignage sera examiné par l'équipe du CMP avant publication 
        pour s'assurer de sa véracité et de son édification pour la communauté.
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button type="button" class="cancel-btn" id="formCancelBtn">Annuler</button>
        <button type="submit" class="submit-btn">Soumettre mon témoignage</button>
      </div>
    </form>
  </div>
  </dialog>

  <!-- My Testimonies Modal -->
  <dialog id="myTestimoniesDialog" class="modal my-testimonies-modal">
    <div class="modal-color-strip"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Mes témoignages</h2>
        <button class="modal-close" type="button">&times;</button>
      </div>
      <div class="modal-body my-testimonies-body">
        <div id="myTestimoniesList" class="my-testimonies-list">
          <!-- Rempli dynamiquement -->
        </div>
      </div>
    </div>
  </dialog>

  <!-- ============================================
       SCRIPTS
       ============================================ -->
  
  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- Application modules (ORDRE IMPORTANT!) -->
  <script src="{% static 'js/config.js' %}"></script>
  <!-- Override TESTIMONIES from backend -->
  <script>
    window.CONFIG = window.CONFIG || {};
    window.CONFIG.TESTIMONIES = {{ testimonies_json|safe }};
  </script>
  <script src="{% static 'js/state.js' %}"></script>
  <script src="{% static 'js/category-init.js' %}"></script>
  <script src="{% static 'js/utils.js' %}"></script>
  <script src="{% static 'js/carousel.js' %}"></script>
  <script src="{% static 'js/testimonies-grid.js' %}"></script>
  <script src="{% static 'js/modals.js' %}"></script>
  <script src="{% static 'js/form.js' %}"></script>
  <script src="{% static 'js/server-submit.js' %}"></script>
  <script src="{% static 'js/stats.js' %}"></script>
  <script src="{% static 'js/auth-otp.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>
  
  <!-- Corrections finales (DOIT ÃŠTRE EN DERNIER) -->
  <script src="{% static 'js/corrections-v2.js' %}"></script>

  <script>

    document.addEventListener('DOMContentLoaded', function () {

      if (window.lucide && typeof window.lucide.createIcons === 'function') {

        window.lucide.createIcons();

      }

    });

  </script>



</body>
</html>





